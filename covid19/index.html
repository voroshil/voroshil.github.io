<!DOCTYPE html>
<html lang="ru">
<head>
  <meta http-equiv="Content-type" content="text/html; charset=utf8">
  <link rel="stylesheet" href="vendor/bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" href="main.css">
  <title>COVID-19: Текущая ситуация в графиках</title>
</head>
<body onLoad="onLoad();">
<h4 align="center">Пандемия COVID-19</h4>
<p align="center">
На основе данных Johns Hopkins University of Medicine
(<a href="https://coronavirus.jhu.edu/map.html">интерактивная карта</a>).
</p>
<p align="center">
Источник предобработанных данных <a href="https://coronavirus.jhu.edu/map.html">
<a href="https://pomber.github.io/covid19/timeseries.json">timeseries.json</a>
(<a href="https://github.com/pomber/covid19">описание</a>)
обновляется ежедневно, приблизительно в 04:00 по Гринвичу.
</p>

<div class="container">
<ul class="nav nav-pills navbar navbar-expand-sm navbar-light navbar-center">
  <li class="nav-item">
    <a class="nav-link active" id="graph-tab" data-toggle="tab" href="#graph" role="tab" aria-controls="graph" aria-selected="true">Графики</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" id="latest-tab" data-toggle="tab" href="#latest" role="tab" aria-controls="latest" aria-selected="false"><span id="latestDate">Последние</span></a>
  </li>
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Таблицы
    </a>
    <div class="dropdown-menu" aria-labelledby="navbarDropdown">
<!--    <li class="nav-item"> -->
      <a class="dropdown-item" id="confirmed-history-tab" data-toggle="tab" href="#confirmed-history" role="tab" aria-controls="confirmed-history" aria-selected="false">Заразившиеся</a>
<!--    </li>
    <li class="nav-item"> -->
      <a class="dropdown-item" id="recovered-history-tab" data-toggle="tab" href="#recovered-history" role="tab" aria-controls="recovered-history" aria-selected="false">Вылечившиеся</a>
<!--    </li>
    <li class="nav-item"> -->
      <a class="dropdown-item" id="death-history-tab" data-toggle="tab" href="#death-history" role="tab" aria-controls="death-history" aria-selected="false">Смерти</a>
<!--    </li>
    <li class="nav-item"> -->
      <a class="dropdown-item" id="active-history-tab" data-toggle="tab" href="#active-history" role="tab" aria-controls="active-history" aria-selected="false">Болеющие</a>
<!--    </li>
    <li class="nav-item"> -->
      <a class="dropdown-item" id="death-rate-history-tab" data-toggle="tab" href="#death-rate-history" role="tab" aria-controls="death-rate-history" aria-selected="false">Летальность, %</a>
<!--    </li>
    <li class="nav-item"> -->
      <a class="dropdown-item" id="something-rate-history-tab" data-toggle="tab" href="#something-rate-history" role="tab" aria-controls="something-rate-history" aria-selected="false">Смертность, %</a>
<!--    </li>
    <li class="nav-item"> -->
      <a class="dropdown-item" id="deaths-estimated-history-tab" data-toggle="tab" href="#deaths-estimated-history" role="tab" aria-controls="deaths-estimated-history" aria-selected="false">Прогноз</a>
<!--    </li> -->
      <div class="dropdown-divider"></div>
      <a class="dropdown-item" id="graph-rate-tab" data-toggle="tab" href="#graphRate" role="tab" aria-controls="graph-rate" aria-selected="false">Графики летальности</a>
    </div>
  </li>
  <li class="nav-item">
      <a class="nav-link" id="dynamic-tab" data-toggle="tab" href="#dynamic" role="tab" aria-controls="dynamic" aria-selected="false">Динамика</a>
  </li>
  <li class="nav-item">
      <a class="nav-link" id="settings-tab" data-toggle="tab" href="#settings" role="tab" aria-controls="settings" aria-selected="false">Настройки</a>
  </li>
</ul>
</div>
<div class="tab-content">
  <div class="tab-pane" id="latest" role="tabpanel" aria-labelledby="latest-tab">
  <h3 align="center">Последний отчет</h3>
    <div class="col-sm-12 container">
      <table class="table table-condensed table-hover" border="1">
        <thead>
        <tr>
          <th>Страна</th>
          <th align="right">Заразившихся</th>
          <th>Выздоровлений</th>
          <th>Смертей</th>
          <th>Болеющих</th>
          <th>Летальность</th>
          <th>Смертность</th>
          <th>Прогноз</th>
        </tr>
        </thead>
        <tbody id="latestStat"></tbody>
      </table>
    </div>
  </div>
  <div class="tab-pane" id="confirmed-history" role="tabpanel" aria-labelledby="confirmed-history-tab">
  <h3 align="center">Заразившиеся</h3>
  <div class="col-sm-12 container">
    <table id = "confirmedHistory" class="table table-condensed table-hover" border="1"></table>
  </div>
  </div> 
  <div class="tab-pane" id="recovered-history" role="tabpanel" aria-labelledby="recovered-history-tab">
  <div class="col-sm-12 container">
  <h3 align="center">Выздоровевшие</h3>
    <table id = "recoveredHistory" class="table table-condensed table-hover"></table>
  </div> 
  </div> 
  <div class="tab-pane" id="death-history" role="tabpanel" aria-labelledby="death-history-tab">
  <div class="col-sm-12 container">
  <h3 align="center">Умершие</h3>
    <table id = "deathHistory" class="table table-condensed table-hover"></table>
  </div> 
  </div> 
  <div class="tab-pane" id="active-history" role="tabpanel" aria-labelledby="active-history-tab">
  <div class="col-sm-12 container">
  <h3 align="center">Болеющие</h3>
    <table id = "activeHistory" class="table table-condensed table-hover"></table>
  </div> 
  </div>
  <div class="tab-pane" id="death-rate-history" role="tabpanel" aria-labelledby="death-rate-history-tab">
  <div class="col-sm-12 container">
  <h3 align="center">Летальность</h3>
    <table id = "deathRateHistory" class="table table-condensed table-hover"></table>
  </div> 
  </div>
  <div class="tab-pane" id="something-rate-history" role="tabpanel" aria-labelledby="something-rate-history-tab">
  <div class="col-sm-12 container">
  <h3 align="center">Смертность</h3>
    <table id = "somethingRateHistory" class="table table-condensed table-hover"></table>
  </div> 
  </div>
  <div class="tab-pane" id="deaths-estimated-history" role="tabpanel" aria-labelledby="deaths-estimated--history-tab">
  <div class="col-sm-12 container">
  <h3 align="center">Прогноз смертей</h3>
    <table id = "deathsEstimatedHistory" class="table table-condensed table-hover"></table>
  </div> 
  </div>
  <div class="tab-pane active" id="graph" role="tabpanel" aria-labelledby="graph-tab">
  <h3 align="center">Графики</h3>
    <div class="col-sm-12 container">
    <table border="1">
      <thead>
      <tr>
        <th>Страна</th>
        <th>Прирост заразившихся</th>
        <th>Смерти / Выздоровления</th>
<!--        <th>Выздоровления - Смерти</th> -->
        <th>Болеющие</th>
      </tr>
      <tr>
        <td>
          Последние данные.<hr/>
          <span style="color:black">Заразившиеся</span>
          <span style="color:orange">Заразившиеся(+/-)</span>
          <span style="color:green">Вылечившиеся(+/-)</span>
          <span style="color:red">Смерти(+/-)</span>
          <span style="color:orange">Болеющие</span>
        </td>
        <td>Ежедневный прирост заразившихся. <br/>Черная линия - центрированное скользящее среднее по 11 точкам. <br/><span style="color:steelblue;">Синим</span> цветом выделены точки минимума и максимума скользящего среднего.</td>
        <td>Ежедневнй прирост выздоровевших и умерших. <br/><span style="color:green;">Зеленая</span> и <span style="color:red;">красная</span> линии - центрированное скользящее среднее по 11 точкам</td>
        <td>Ежедневный прирост болеющих. <Br/>Черная линия - центрированное скользящее среднее по 11 точкам. <br/><span style="color:steelblue;">Синим</span> цветом выделены точки минимума и максимума скользящего среднего.</td>
      </tr>
      </thead>
      <tbody id="graphTableBody">
      <tbody>
    </table>
    </div>
  </div>
  <div class="tab-pane" id="graphRate" role="tabpanel" aria-labelledby="graph-rate-tab">
  <h3 align="center">Графики летальности</h3>
    <div class="col-sm-8 container">
    <table border="1">
      <thead>
      <tr>
        <th>Страна</th>
        <th>Летальность</th>
        <th>Летальность-14</th>
      </tr>
      <tr>
        <td>
        </td>
        <td>летальность = умерших / (умерших+излечившихся) * 100%<br/><b>Аномально высокие значения в некоторых странах связаны с отсутствием информации об излечившихся.</b><br/> Черная линия - центрированное скользящее среднее по 11 точкам. <br/><span style="color:steelblue;">Синим</span> цветом выделена точка максимума скользящего среднего.</td>
        <td>летальность-14 = умерших / (умерших+излечившихся спустя 14 дней) * 100%<br/><b>Аномально высокие значения в некоторых странах связаны с отсутствием информации об излечившихся.</b><br/> Черная линия - центрированное скользящее среднее по 11 точкам. <br/><span style="color:steelblue;">Синим</span> цветом выделена точка максимума скользящего среднего.</td>
      </tr>
      </thead>
      <tbody id="graphRateTableBody">
      <tbody>
    </table>
    </div>
  </div>
  <div class="tab-pane" id="settings" role="tabpanel" aria-labelledby="settings-tab">
  <h3 align="center">Настройки</h3>
    <div class="col-sm-8 container">
      <form>
        <div class="form-row">
          <div class="col">
            <label for="settingsMaxThreshold">Минимально заразившихся</label>
            <input type="number" class="form-control" aria-describedBy="settingsMaxThresholdHelp" placeHolder="Введите количество" id="settingsMaxThreshold" value=""/>
            <small id="settingsMaxThresholdHelp" class="form-text text-muted">Минимальное количество заразившихся для отображения страны в таблицах</small>
          </div>
          <div class="col">
            <label for="settingsThresholdCountry">Ограничить список страной</label>
            <select class="form-control" aria-describedBy="settingsThresholdCountryHelp" placeHolder="Укажите страну" id="settingsThresholdCountry" value="">
            </select>
            <small id="settingsThresholdCountryHelp" class="form-text text-muted">Не выводить страны с количеством заразившихся менее чем в указанной</small>
          </div>
        </div>
        <div class="form-group">
          <label for="settingsPeriodThreshold">Период отображения</label>
          <input type="number" class="form-control" aria-describedBy="settingsPeriodThresholdHelp" placeHolder="Введите количество" id="settingsPeriodThreshold" value=""/>
          <small id="settingsPeriodThresholdHelp" class="form-text text-muted">Длина периода (в днях) для отображения на графиках</small>
        </div>
        <div class="form-check">
          <input type="checkbox" class="form-check-input" id="settingsShowHorizontal"/>
          <label class="Form-check-label" for="settingsShowHorizontal">Отображение горизонтальных линий на графиках</label>
        </div>
        <div class="form-group">
          <label for="settingsDynamicThreshold">Минимальный порог для графиков динамики пандемии</label>
          <input type="number" class="form-control" aria-describedBy="settingsDynamicThresholdHelp" placeHolder="Введите количество" id="settingsDynamicThreshold" value=""/>
          <small id="settingsDynamicThresholdHelp" class="form-text text-muted">Длина периода (в днях) для отображения на графиках</small>
        </div>
        <button type="button" class="btn btn-primary" onClick="updateConfig()">Сохранить и перерисовать</button>
      </form>
    </div>
  </div>
  <div class="tab-pane" id="dynamic" role="tabpanel" aria-labelledby="dynamic-tab">
  <h3 align="center">Динамика</h3>
    <p align="center">Начало графика - день, когда количество заразившихся в стране превысило значение <span id="dynamic-threshold"></span></p>
    <div class="col-sm-8 container" id="dynamic-confirmed"></div>
    <div class="col-sm-8 container" id="dynamic-recovered"></div>
    <div class="col-sm-8 container" id="dynamic-deaths"></div>
    <div class="col-sm-8 container" id="dynamic-active"></div>
  </div>
</div>


<div class="modal" tabindex="-1" role="dialog" id="manualModal">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Актуальные данные: <span id="manualName"></span></h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
      <form>
        <input type="hidden" id="manualCountry">
        <div class="form-group">
          <label for="manualConfirmed">Заразившихся</label>
          <input type="text" class="form-control" aria-describedBy="manualConfirmedHelp" placeHolder="Введите количество" id="manualConfirmed" value=""/>
        </div>
        <div class="form-group">
          <label for="manualRecovered">Излечившихся</label>
          <input type="text" class="form-control" aria-describedBy="manualRecoveredHelp" placeHolder="Введите количество" id="manualRecovered" value=""/>
        </div>
        <div class="form-group">
          <label for="manualDeaths">Смертей</label>
          <input type="text" class="form-control" aria-describedBy="manualDeathsHelp" placeHolder="Введите количество" id="manualDeaths" value=""/>
        </div>
      </form>

      </div>
      <div class="modal-footer">
        <button type="button" onClick="onManualUpdate()" class="btn btn-primary">Сохранить</button>
        <button type="button" onClick="onManualReset()" class="btn btn-warning">Сброс</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Закрыть</button>
      </div>
    </div>
  </div>
</div>

<div class="modal" tabindex="-1" role="dialog" id="graphModal">
  <div class="modal-dialog modal-lg" role="document"">
    <div class="modal-content" style="width:800px;">
      <div class="modal-header">
        <h5 class="modal-title">График: <span id="graphName"></span></h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" id="largeGraph" style="width:800px;">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Закрыть</button>
      </div>
    </div>
  </div>
</div>


<script language="javascript" src="vendor/jquery-3.4.1.min.js"></script>
<script language="javascript" src="vendor/popper.js"></script>
<script language="javascript" src="vendor/bootstrap/js/bootstrap.min.js"></script>
<script language="javascript" src="vendor/moment.js"></script>
<script language="javascript" src="vendor/d3.js"></script>

<script language="javascript" src="timeseries.js"></script>
<script language="javascript" src="script.js"></script>
<script id="latestStatTemplate" language="xTemplate">
</script>
</body>
</html>
